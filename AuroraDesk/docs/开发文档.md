# 开发文档（对齐当前实现）

本页聚焦当前仓库中的实际代码与近期演进方向，便于快速上手与维护。

---

## 1. 项目简介

AuroraDesk 是一款 Windows 动态壁纸管理器，支持将本地网页/图片等渲染为桌面壁纸，并具备后续扩展为视频/Shader 的空间。

---

## 2. 代码结构与关键模块

详见 `docs/项目结构.md`。以下为当前实现中最相关的模块：

- `Core/`
  - `DesktopHost.cs`：WorkerW/桌面挂载与宿主窗口管理。
  - `Win32Window.cs`：Win32 窗口封装/句柄操作。
  - `NativeMethods.cs`：P/Invoke 声明集中。
  - `WallpaperManager.cs`：壁纸生命周期与调度（如存在差异以项目内为准）。
- `Controls/`
  - `LogoShowcase.xaml(.cs)`：控件示例与 UI 集成范例。
- `Models/`
  - `WallpaperItem.cs`：壁纸项数据模型。
- `Library/wallpapers/`：示例壁纸素材（HTML/图片/脚本等）。
- `Utilities/IconGenerator.cs`：图标工具相关实用函数。

注意：仓库根目录存在历史版本的 `DesktopHost.cs`、`NativeMethods.cs`、`Win32Window.cs` 与 `MonitorManager.cs`。清理与迁移策略见 `docs/项目结构.md` 的“清理与迁移”。

---

## 3. 构建与运行

- 先决条件：.NET 8 SDK、Windows 10 19041+。
- 在解决方案根目录执行：
  - 使用 IDE（Visual Studio 2022 或 Rider）打开 `AuroraDesk.sln`；
  - 选择 `AuroraDesk` 项目，目标 `x64/Debug`；
  - 直接编译运行。

---

## 4. 壁纸资源与演示

- 本地网页/图片示例位于 `Library/wallpapers/`，可在应用中引用测试。
- 后续可将视频/Shader 等来源放入 `Assets/` 或 `Library/`，并在 `Sources/` 目录内逐步补齐实现。

---

## 5. 日志与调试约定

- 统一使用 `LogManager`（如项目引入后）；暂未引入时，避免使用 `printf/cout/QDebug`，仅在必要位置使用标准日志封装。
- 异常处理遵守早返回与错误优先，以便快速定位问题。

---

## 6. 风格与规范（摘要）

- 变量命名：`snake_case`；函数/类：`CamelCase`。
- 缩进：4 空格；大括号独立成行；只缩进代码不缩进括号。
- 遍历数组/向量：使用 C 风格索引 `for`；强转优先 C 风格。
- `struct` 仅含数据；`class` 用于包含函数的对象。
- 硬编码常量：使用 `#define`（需要指针除外）。
- 容器：定长用 C 数组；变长用 `std::vector/std::string`，定长字符串可用 C 缓冲。

---

## 7. 图标与打包

- 应用图标资源位于 `Assets/`，已包含多尺寸 `PNG`；
- 图标制作与生成说明见 `docs/应用图标配置说明.md`；
- 如需重新生成，优先使用仓库内脚本或工具链（见图标文档中的“SVG 转 PNG”与资产映射）。

---

## 8. 计划中的扩展

- `Sources/VideoSource`、`Sources/WebSource`、`Sources/ShaderSource` 等分层实现；
- 多显示器管理（`MonitorManager`）统一纳入 `Core/` 并文档化；
- 引入结构化日志（`LogManager`）与运行目录规范（`%LOCALAPPDATA%/AuroraDesk/Logs` 等）。

---

## 9. 文档维护

- 接口/行为变化需同步更新 `docs/开发文档.md`、`docs/项目结构.md` 与示例；
- 移除策略：删除即彻底删除；不留死代码/桩/标志位/临时开关/注释代码/TODO；
- 提交信息遵循 Conventional Commits 规范。
